{"ast":null,"code":"import { FormControl, FormGroup } from '@angular/forms';\nimport * as ApexCharts from 'apexcharts';\nimport * as moment from 'moment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/services/person-activity.service\";\nimport * as i2 from \"@angular/material/form-field\";\nimport * as i3 from \"@angular/material/input\";\nimport * as i4 from \"@angular/material/datepicker\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"@angular/material/core\";\nimport * as i7 from \"@angular/material/select\";\nimport * as i8 from \"@angular/forms\";\nimport * as i9 from \"ng-apexcharts\";\nfunction GenderChartsComponent_div_13_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"mat-form-field\")(2, \"mat-label\");\n    i0.ɵɵtext(3, \"S\\u00E9lectionner une plage de semaines\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"input\", 9);\n    i0.ɵɵlistener(\"ngModelChange\", function GenderChartsComponent_div_13_Template_input_ngModelChange_4_listener($event) {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r7 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r7.startWeek = $event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(5, \"mat-datepicker-toggle\", 10);\n    i0.ɵɵelementStart(6, \"mat-datepicker\", 11, 12);\n    i0.ɵɵlistener(\"yearSelected\", function GenderChartsComponent_div_13_Template_mat_datepicker_yearSelected_6_listener($event) {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r9 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r9.chosenYearHandler($event));\n    })(\"monthSelected\", function GenderChartsComponent_div_13_Template_mat_datepicker_monthSelected_6_listener($event) {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r10 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r10.chosenMonthHandler($event));\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(8, \"mat-form-field\")(9, \"input\", 13);\n    i0.ɵɵlistener(\"ngModelChange\", function GenderChartsComponent_div_13_Template_input_ngModelChange_9_listener($event) {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r11 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r11.endWeek = $event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(10, \"mat-datepicker-toggle\", 10);\n    i0.ɵɵelementStart(11, \"mat-datepicker\", 11, 14);\n    i0.ɵɵlistener(\"yearSelected\", function GenderChartsComponent_div_13_Template_mat_datepicker_yearSelected_11_listener($event) {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r12 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r12.chosenYearHandler($event));\n    })(\"monthSelected\", function GenderChartsComponent_div_13_Template_mat_datepicker_monthSelected_11_listener($event) {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r13 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r13.chosenMonthHandler($event));\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(13, \"button\", 15);\n    i0.ɵɵlistener(\"click\", function GenderChartsComponent_div_13_Template_button_click_13_listener() {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r14 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r14.submit());\n    });\n    i0.ɵɵtext(14, \"submit\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"mat-form-field\");\n    i0.ɵɵelement(16, \"input\", 16)(17, \"mat-datepicker-toggle\", 10)(18, \"mat-datepicker\", null, 17);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const _r4 = i0.ɵɵreference(7);\n    const _r5 = i0.ɵɵreference(12);\n    const _r6 = i0.ɵɵreference(19);\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"matDatepicker\", _r4)(\"ngModel\", ctx_r0.startWeek);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"for\", _r4);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"matDatepicker\", _r5)(\"ngModel\", ctx_r0.endWeek);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"for\", _r5);\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"matDatepicker\", _r6);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"for\", _r6);\n  }\n}\nfunction GenderChartsComponent_div_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"mat-form-field\");\n    i0.ɵɵelement(2, \"input\", 18)(3, \"mat-datepicker-toggle\", 10)(4, \"mat-datepicker\", null, 19);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"mat-form-field\");\n    i0.ɵɵelement(7, \"input\", 16)(8, \"mat-datepicker-toggle\", 10)(9, \"mat-datepicker\", null, 17);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const _r15 = i0.ɵɵreference(5);\n    const _r16 = i0.ɵɵreference(10);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"matDatepicker\", _r15);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"for\", _r15);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"matDatepicker\", _r16);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"for\", _r16);\n  }\n}\nfunction GenderChartsComponent_div_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"mat-form-field\");\n    i0.ɵɵelement(2, \"input\", 16)(3, \"mat-datepicker-toggle\", 10)(4, \"mat-datepicker\", null, 17);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const _r17 = i0.ɵɵreference(5);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"matDatepicker\", _r17);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"for\", _r17);\n  }\n}\nfunction GenderChartsComponent_div_16_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r20 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"mat-form-field\")(2, \"mat-label\");\n    i0.ɵɵtext(3, \"Enter a date range\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"mat-date-range-input\", 20);\n    i0.ɵɵelement(5, \"input\", 21);\n    i0.ɵɵelementStart(6, \"input\", 22);\n    i0.ɵɵlistener(\"dateChange\", function GenderChartsComponent_div_16_Template_input_dateChange_6_listener() {\n      i0.ɵɵrestoreView(_r20);\n      const ctx_r19 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r19.onEndDateSelected());\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelement(7, \"mat-datepicker-toggle\", 10)(8, \"mat-date-range-picker\", null, 12);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const _r18 = i0.ɵɵreference(9);\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"rangePicker\", _r18);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"formControl\", ctx_r3.startDateControl);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"formControl\", ctx_r3.endDateControl);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"for\", _r18);\n  }\n}\nexport let GenderChartsComponent = /*#__PURE__*/(() => {\n  class GenderChartsComponent {\n    constructor(personActivityService) {\n      this.personActivityService = personActivityService;\n      this.userData = [];\n      this.periodType = new FormControl(\"week\");\n      this.chart = {\n        chart: {\n          type: \"donut\",\n          id: '1'\n        },\n        series: [0, 0],\n        labels: [\"Hommes\", \"Femmes\"],\n        colors: [\"#008FFB\", \"#FF4560\"],\n        title: {\n          text: \"Répartition hommes/femmes\",\n          align: \"center\",\n          margin: 10,\n          offsetY: 20,\n          style: {\n            fontSize: \"25px\"\n          }\n        },\n        plotOptions: {\n          pie: {\n            donut: {\n              labels: {\n                show: true,\n                name: {\n                  show: true\n                },\n                value: {\n                  show: true,\n                  formatter: function (val) {\n                    return val + \" (\" + Math.round(val / this.chart.series[0].data.reduce((a, b) => a + b) * 100) + \"%)\";\n                  }\n                },\n                total: {\n                  show: true,\n                  formatter: function (val) {\n                    return Math.round(val / this.series[0].data.reduce((a, b) => a + b) * 100) + \"%\";\n                  }\n                }\n              }\n            }\n          }\n        }\n      };\n      this.ranges = Array.from(Array(52), (_, i) => `Semaine ${i + 1}`);\n      this.startDateControl = new FormControl();\n      this.endDateControl = new FormControl();\n    }\n    ngOnInit() {\n      this.weekRangeFormGroup = new FormGroup({\n        start: new FormControl(),\n        end: new FormControl(),\n        selectedRange: new FormControl()\n      });\n      this.periodType.setValue(\"week\");\n      this.year = parseInt(moment().format(\"y\"));\n      this.month = parseInt(moment().format(\"M\"));\n      this.weekNumber = parseInt(moment().format(\"w\"));\n      this.startDate = new Date(this.year, this.month);\n      this.endDate = new Date();\n      this.weekRangeFormGroup.get('selectedRange').valueChanges.subscribe(range => {\n        const [startWeek, endWeek] = range.split('-').map(Number);\n        console.log(`Plage de semaines sélectionnée : ${startWeek} à ${endWeek}`);\n      });\n      // initialisation du graphique\n      this.getUserData(12, 2023);\n    }\n    onEndDateSelected() {\n      console.log('End date selected:', this.endDateControl.value);\n      // Placez ici votre code pour traiter l'événement de sélection de matEndDate\n    }\n\n    chosenYearHandler(normalizedYear) {\n      const ctrlValue = this.startWeek || new Date();\n      ctrlValue.setFullYear(normalizedYear.getFullYear());\n      this.startWeek = ctrlValue;\n      this.endWeek = null;\n    }\n    chosenMonthHandler(normalizedMonth) {\n      const ctrlValue = this.startWeek || new Date();\n      ctrlValue.setMonth(normalizedMonth.getMonth());\n      this.startWeek = ctrlValue;\n      this.endWeek = null;\n    }\n    submit() {\n      console.log(`Plage de semaines sélectionnée : ${this.startWeek} à ${this.endWeek}`);\n    }\n    getWeekNumber(date) {\n      const firstDayOfYear = new Date(date.getFullYear(), 0, 1);\n      const pastDaysOfYear = (date.getTime() - firstDayOfYear.getTime()) / 86400000;\n      return Math.ceil((pastDaysOfYear + firstDayOfYear.getDay() + 1) / 7);\n    }\n    getUserData(week, year) {\n      if (!week && !year) {\n        this.personActivityService.getData(week, year).subscribe({\n          next: data => {\n            this.userData = data;\n            this.updateChartData();\n          }\n        });\n      }\n      this.personActivityService.getData(week, year).subscribe({\n        next: data => {\n          this.userData = data;\n          this.updateChartData();\n        }\n      });\n    }\n    updateChartData() {\n      let filteredData = [];\n      if (this.periodType.value === \"week\") {\n        filteredData = this.userData.filter(person => {\n          let weekDate = new Date(person.PersonActivities[0].Year, 0, 1);\n          weekDate.setDate(1 - weekDate.getDay() + (weekDate.getDay() > 4 ? 7 : 0));\n          weekDate.setDate(weekDate.getDate() + 7 * (this.weekNumber - 1));\n          return weekDate.getFullYear() === this.year && person.PersonActivities.some(activity => activity.Value > 0);\n        });\n      } else if (this.periodType.value === \"month\") {\n        filteredData = this.userData.filter(person => {\n          return new Date(person.PersonActivities[0].Year, person.PersonActivities[0].Week * 7).getMonth() === this.month - 1 && person.PersonActivities.some(activity => activity.Value > 0);\n        });\n      } else if (this.periodType.value === \"year\") {\n        filteredData = this.userData.filter(person => {\n          return new Date(person.PersonActivities[0].Year, person.PersonActivities[0].Week * 7).getFullYear() === this.year && person.PersonActivities.some(activity => activity.Value > 0);\n        });\n      } else if (this.periodType.value === \"range\") {\n        filteredData = this.userData.filter(person => {\n          return person.PersonActivities.some(activity => activity.Value > 0 && new Date(activity.Year, 0).getTime() >= this.startDate.getTime() && new Date(activity.Year, 0).getTime() <= this.endDate.getTime());\n        });\n      }\n      let malesCount = filteredData.filter(person => person.GenderId === 1).length;\n      let femalesCount = filteredData.filter(person => person.GenderId === 2).length;\n      if (this.chart) {\n        this.chart.series = [{\n          name: \"Hommes\",\n          data: [malesCount]\n        }, {\n          name: \"Femmes\",\n          data: [femalesCount]\n        }];\n        ApexCharts.exec(this.chart.chart.id, \"updateOptions\", {\n          labels: [\"Hommes\", \"Femmes\"],\n          series: [{\n            name: \"Hommes\",\n            data: [malesCount]\n          }, {\n            name: \"Femmes\",\n            data: [femalesCount]\n          }]\n        });\n      }\n    }\n  }\n  GenderChartsComponent.ɵfac = function GenderChartsComponent_Factory(t) {\n    return new (t || GenderChartsComponent)(i0.ɵɵdirectiveInject(i1.PersonActivityService));\n  };\n  GenderChartsComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: GenderChartsComponent,\n    selectors: [[\"app-gender-charts\"]],\n    decls: 20,\n    vars: 8,\n    consts: [[3, \"formGroup\"], [3, \"formControl\"], [\"value\", \"week\"], [\"value\", \"month\"], [\"value\", \"year\"], [\"value\", \"range\"], [4, \"ngIf\"], [3, \"click\"], [3, \"series\", \"chart\"], [\"matInput\", \"\", \"placeholder\", \"Semaine de d\\u00E9but\", 3, \"matDatepicker\", \"ngModel\", \"ngModelChange\"], [\"matSuffix\", \"\", 3, \"for\"], [\"startView\", \"multi-year\", \"panelClass\", \"week-picker\", 3, \"yearSelected\", \"monthSelected\"], [\"picker\", \"\"], [\"matInput\", \"\", \"placeholder\", \"Semaine de fin\", 3, \"matDatepicker\", \"ngModel\", \"ngModelChange\"], [\"picker2\", \"\"], [\"type\", \"button\", 3, \"click\"], [\"matInput\", \"\", \"placeholder\", \"Ann\\u00E9e\", 3, \"matDatepicker\"], [\"yearPicker\", \"\"], [\"matInput\", \"\", \"placeholder\", \"Mois\", 3, \"matDatepicker\"], [\"monthPicker\", \"\"], [3, \"rangePicker\"], [\"matStartDate\", \"\", \"matInput\", \"\", \"placeholder\", \"Start date\", 3, \"formControl\"], [\"matEndDate\", \"\", \"matInput\", \"\", \"placeholder\", \"End date\", 3, \"formControl\", \"dateChange\"]],\n    template: function GenderChartsComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"mat-form-field\")(2, \"mat-label\");\n        i0.ɵɵtext(3, \"Periode\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"mat-select\", 1)(5, \"mat-option\", 2);\n        i0.ɵɵtext(6, \"Semaine\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(7, \"mat-option\", 3);\n        i0.ɵɵtext(8, \"Mois\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(9, \"mat-option\", 4);\n        i0.ɵɵtext(10, \"Ann\\u00E9e\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(11, \"mat-option\", 5);\n        i0.ɵɵtext(12, \"Plage de dates\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵtemplate(13, GenderChartsComponent_div_13_Template, 20, 8, \"div\", 6);\n        i0.ɵɵtemplate(14, GenderChartsComponent_div_14_Template, 11, 4, \"div\", 6);\n        i0.ɵɵtemplate(15, GenderChartsComponent_div_15_Template, 6, 2, \"div\", 6);\n        i0.ɵɵtemplate(16, GenderChartsComponent_div_16_Template, 10, 4, \"div\", 6);\n        i0.ɵɵelementStart(17, \"button\", 7);\n        i0.ɵɵlistener(\"click\", function GenderChartsComponent_Template_button_click_17_listener() {\n          return ctx.getUserData();\n        });\n        i0.ɵɵtext(18, \"Load data\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(19, \"apx-chart\", 8);\n        i0.ɵɵelementEnd();\n      }\n      if (rf & 2) {\n        i0.ɵɵproperty(\"formGroup\", ctx.weekRangeFormGroup);\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"formControl\", ctx.periodType);\n        i0.ɵɵadvance(9);\n        i0.ɵɵproperty(\"ngIf\", ctx.periodType.value === \"week\");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.periodType.value === \"month\");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.periodType.value === \"year\");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.periodType.value === \"range\");\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"series\", ctx.userData)(\"chart\", ctx.chart);\n      }\n    },\n    dependencies: [i2.MatFormField, i2.MatLabel, i2.MatSuffix, i3.MatInput, i4.MatDatepicker, i4.MatDatepickerInput, i4.MatDatepickerToggle, i4.MatDateRangeInput, i4.MatStartDate, i4.MatEndDate, i4.MatDateRangePicker, i5.NgIf, i6.MatOption, i7.MatSelect, i8.DefaultValueAccessor, i8.NgControlStatus, i8.NgControlStatusGroup, i8.NgModel, i8.FormControlDirective, i8.FormGroupDirective, i9.ChartComponent]\n  });\n  return GenderChartsComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}