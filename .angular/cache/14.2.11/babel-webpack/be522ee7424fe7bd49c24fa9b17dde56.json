{"ast":null,"code":"import * as ApexCharts from 'apexcharts';\nimport * as moment from 'moment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/services/person-activity.service\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"@angular/material/form-field\";\nimport * as i4 from \"@angular/material/input\";\nimport * as i5 from \"@angular/material/core\";\nimport * as i6 from \"@angular/material/datepicker\";\nimport * as i7 from \"@angular/material/select\";\nimport * as i8 from \"@angular/forms\";\nimport * as i9 from \"ng-apexcharts\";\nfunction GenderChartsComponent_div_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"mat-form-field\");\n    i0.ɵɵelement(2, \"input\", 7)(3, \"mat-datepicker-toggle\", 8)(4, \"mat-datepicker\", null, 9);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"mat-form-field\");\n    i0.ɵɵelement(7, \"input\", 10)(8, \"mat-datepicker-toggle\", 8)(9, \"mat-datepicker\", null, 11);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const _r4 = i0.ɵɵreference(5);\n    const _r5 = i0.ɵɵreference(10);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"matDatepicker\", _r4);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"for\", _r4);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"matDatepicker\", _r5);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"for\", _r5);\n  }\n}\nfunction GenderChartsComponent_div_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"mat-form-field\");\n    i0.ɵɵelement(2, \"input\", 12)(3, \"mat-datepicker-toggle\", 8)(4, \"mat-datepicker\", null, 13);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"mat-form-field\");\n    i0.ɵɵelement(7, \"input\", 10)(8, \"mat-datepicker-toggle\", 8)(9, \"mat-datepicker\", null, 11);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const _r6 = i0.ɵɵreference(5);\n    const _r7 = i0.ɵɵreference(10);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"matDatepicker\", _r6);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"for\", _r6);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"matDatepicker\", _r7);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"for\", _r7);\n  }\n}\nfunction GenderChartsComponent_div_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"mat-form-field\");\n    i0.ɵɵelement(2, \"input\", 10)(3, \"mat-datepicker-toggle\", 8)(4, \"mat-datepicker\", null, 11);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const _r8 = i0.ɵɵreference(5);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"matDatepicker\", _r8);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"for\", _r8);\n  }\n}\nfunction GenderChartsComponent_div_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"mat-form-field\");\n    i0.ɵɵelement(2, \"input\", 14)(3, \"mat-datepicker-toggle\", 8)(4, \"mat-datepicker\", null, 15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"mat-form-field\");\n    i0.ɵɵelement(7, \"input\", 16)(8, \"mat-datepicker-toggle\", 8)(9, \"mat-datepicker\", null, 17);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const _r9 = i0.ɵɵreference(5);\n    const _r10 = i0.ɵɵreference(10);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"matDatepicker\", _r9);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"for\", _r9);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"matDatepicker\", _r10);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"for\", _r10);\n  }\n}\nexport let GenderChartsComponent = /*#__PURE__*/(() => {\n  class GenderChartsComponent {\n    constructor(personActivityService) {\n      this.personActivityService = personActivityService;\n      this.periodType = \"week\";\n      this.userData = [];\n      this.chart = {\n        chart: {\n          type: \"donut\",\n          id: '1'\n        },\n        series: [0, 0],\n        labels: [\"Hommes\", \"Femmes\"],\n        colors: [\"#008FFB\", \"#FF4560\"],\n        title: {\n          text: \"Répartition hommes/femmes\",\n          align: \"center\",\n          margin: 10,\n          offsetY: 20,\n          style: {\n            fontSize: \"25px\"\n          }\n        },\n        plotOptions: {\n          pie: {\n            donut: {\n              labels: {\n                show: true,\n                name: {\n                  show: true\n                },\n                value: {\n                  show: true,\n                  formatter: function (val) {\n                    return val + \" (\" + Math.round(val / this.chart.series[0].data.reduce((a, b) => a + b) * 100) + \"%)\";\n                  }\n                },\n                total: {\n                  show: true,\n                  formatter: function (val) {\n                    return Math.round(val / this.series[0].data.reduce((a, b) => a + b) * 100) + \"%\";\n                  }\n                }\n              }\n            }\n          }\n        }\n      };\n    }\n    ngOnInit() {\n      this.periodType = \"week\";\n      this.year = parseInt(moment().format(\"y\"));\n      this.month = parseInt(moment().format(\"M\"));\n      this.weekNumber = parseInt(moment().format(\"w\"));\n      this.startDate = new Date(this.year, this.month);\n      this.endDate = new Date();\n      // initialisation du graphique\n      this.getUserData(12, 2023);\n    }\n    getUserData(week, year) {\n      this.personActivityService.getData(week, year).subscribe({\n        next: data => {\n          this.userData = data;\n          this.updateChartData();\n        }\n      });\n    }\n    updateChartData() {\n      let filteredData = [];\n      if (this.periodType === \"week\") {\n        filteredData = this.userData.filter(person => {\n          let weekDate = new Date(person.PersonActivities[0].Year, 0, 1);\n          weekDate.setDate(1 - weekDate.getDay() + (weekDate.getDay() > 4 ? 7 : 0));\n          weekDate.setDate(weekDate.getDate() + 7 * (this.weekNumber - 1));\n          return weekDate.getFullYear() === this.year && person.PersonActivities.some(activity => activity.Value > 0);\n        });\n      } else if (this.periodType === \"month\") {\n        filteredData = this.userData.filter(person => {\n          return new Date(person.PersonActivities[0].Year, person.PersonActivities[0].Week * 7).getMonth() === this.month - 1 && person.PersonActivities.some(activity => activity.Value > 0);\n        });\n      } else if (this.periodType === \"year\") {\n        filteredData = this.userData.filter(person => {\n          return new Date(person.PersonActivities[0].Year, person.PersonActivities[0].Week * 7).getFullYear() === this.year && person.PersonActivities.some(activity => activity.Value > 0);\n        });\n      } else if (this.periodType === \"range\") {\n        filteredData = this.userData.filter(person => {\n          return person.PersonActivities.some(activity => activity.Value > 0 && new Date(activity.Year, 0).getTime() >= this.startDate.getTime() && new Date(activity.Year, 0).getTime() <= this.endDate.getTime());\n        });\n      }\n      let malesCount = filteredData.filter(person => person.GenderId === 1).length;\n      let femalesCount = filteredData.filter(person => person.GenderId === 2).length;\n      console.log(this.chart);\n      if (this.chart) {\n        this.chart.series = [malesCount, femalesCount];\n        ApexCharts.exec(this.chart.chart.id, \"updateOptions\", {\n          labels: [\"Hommes\", \"Femmes\"],\n          series: [malesCount, femalesCount]\n        });\n      }\n    }\n  }\n  GenderChartsComponent.ɵfac = function GenderChartsComponent_Factory(t) {\n    return new (t || GenderChartsComponent)(i0.ɵɵdirectiveInject(i1.PersonActivityService));\n  };\n  GenderChartsComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: GenderChartsComponent,\n    selectors: [[\"app-gender-charts\"]],\n    decls: 17,\n    vars: 7,\n    consts: [[3, \"ngModel\", \"ngModelChange\"], [\"value\", \"week\"], [\"value\", \"month\"], [\"value\", \"year\"], [\"value\", \"range\"], [4, \"ngIf\"], [3, \"series\", \"chart\"], [\"matInput\", \"\", \"placeholder\", \"Semaine\", 3, \"matDatepicker\"], [\"matSuffix\", \"\", 3, \"for\"], [\"weekPicker\", \"\"], [\"matInput\", \"\", \"placeholder\", \"Ann\\u00E9e\", 3, \"matDatepicker\"], [\"yearPicker\", \"\"], [\"matInput\", \"\", \"placeholder\", \"Mois\", 3, \"matDatepicker\"], [\"monthPicker\", \"\"], [\"matInput\", \"\", \"placeholder\", \"Start Date\", 3, \"matDatepicker\"], [\"startDatePicker\", \"\"], [\"matInput\", \"\", \"placeholder\", \"End Date\", 3, \"matDatepicker\"], [\"endDatePicker\", \"\"]],\n    template: function GenderChartsComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"mat-form-field\")(1, \"mat-label\");\n        i0.ɵɵtext(2, \"Periode\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(3, \"mat-select\", 0);\n        i0.ɵɵlistener(\"ngModelChange\", function GenderChartsComponent_Template_mat_select_ngModelChange_3_listener($event) {\n          return ctx.periodType = $event;\n        });\n        i0.ɵɵelementStart(4, \"mat-option\", 1);\n        i0.ɵɵtext(5, \"Semaine\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(6, \"mat-option\", 2);\n        i0.ɵɵtext(7, \"Mois\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(8, \"mat-option\", 3);\n        i0.ɵɵtext(9, \"Ann\\u00E9e\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(10, \"mat-option\", 4);\n        i0.ɵɵtext(11, \"Plage de dates\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵtemplate(12, GenderChartsComponent_div_12_Template, 11, 4, \"div\", 5);\n        i0.ɵɵtemplate(13, GenderChartsComponent_div_13_Template, 11, 4, \"div\", 5);\n        i0.ɵɵtemplate(14, GenderChartsComponent_div_14_Template, 6, 2, \"div\", 5);\n        i0.ɵɵtemplate(15, GenderChartsComponent_div_15_Template, 11, 4, \"div\", 5);\n        i0.ɵɵelement(16, \"apx-chart\", 6);\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngModel\", ctx.periodType);\n        i0.ɵɵadvance(9);\n        i0.ɵɵproperty(\"ngIf\", ctx.periodType === \"week\");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.periodType === \"month\");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.periodType === \"year\");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.periodType === \"range\");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"series\", ctx.userData)(\"chart\", ctx.chart);\n      }\n    },\n    dependencies: [i2.NgIf, i3.MatFormField, i3.MatLabel, i3.MatSuffix, i4.MatInput, i5.MatOption, i6.MatDatepicker, i6.MatDatepickerInput, i6.MatDatepickerToggle, i7.MatSelect, i8.NgControlStatus, i8.NgModel, i9.ChartComponent]\n  });\n  return GenderChartsComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}