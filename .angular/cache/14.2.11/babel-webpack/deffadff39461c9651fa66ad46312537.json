{"ast":null,"code":"import { FormControl, FormGroup } from '@angular/forms';\nimport * as ApexCharts from 'apexcharts';\nimport * as moment from 'moment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/services/person-activity.service\";\nimport * as i2 from \"@angular/material/form-field\";\nimport * as i3 from \"@angular/material/input\";\nimport * as i4 from \"@angular/material/datepicker\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"@angular/material/core\";\nimport * as i7 from \"@angular/material/select\";\nimport * as i8 from \"@angular/forms\";\nimport * as i9 from \"ng-apexcharts\";\nfunction GenderChartsComponent_div_12_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"mat-form-field\");\n    i0.ɵɵelement(2, \"input\", 8)(3, \"mat-datepicker-toggle\", 9);\n    i0.ɵɵelementStart(4, \"mat-datepicker\", 10, 11);\n    i0.ɵɵlistener(\"selectedChanged\", function GenderChartsComponent_div_12_Template_mat_datepicker_selectedChanged_4_listener($event) {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r6 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r6.onWeekSelected($event));\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(6, \"mat-form-field\");\n    i0.ɵɵelement(7, \"input\", 12)(8, \"mat-datepicker-toggle\", 9)(9, \"mat-datepicker\", null, 13);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const _r4 = i0.ɵɵreference(5);\n    const _r5 = i0.ɵɵreference(10);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"matDatepicker\", _r4);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"for\", _r4);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"matDatepicker\", _r5);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"for\", _r5);\n  }\n}\nfunction GenderChartsComponent_div_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"mat-form-field\");\n    i0.ɵɵelement(2, \"input\", 14)(3, \"mat-datepicker-toggle\", 9)(4, \"mat-datepicker\", null, 15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"mat-form-field\");\n    i0.ɵɵelement(7, \"input\", 12)(8, \"mat-datepicker-toggle\", 9)(9, \"mat-datepicker\", null, 13);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const _r8 = i0.ɵɵreference(5);\n    const _r9 = i0.ɵɵreference(10);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"matDatepicker\", _r8);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"for\", _r8);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"matDatepicker\", _r9);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"for\", _r9);\n  }\n}\nfunction GenderChartsComponent_div_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"mat-form-field\");\n    i0.ɵɵelement(2, \"input\", 12)(3, \"mat-datepicker-toggle\", 9)(4, \"mat-datepicker\", null, 13);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const _r10 = i0.ɵɵreference(5);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"matDatepicker\", _r10);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"for\", _r10);\n  }\n}\nfunction GenderChartsComponent_div_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"mat-form-field\");\n    i0.ɵɵelement(2, \"input\", 16)(3, \"mat-datepicker-toggle\", 9)(4, \"mat-datepicker\", null, 17);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"mat-form-field\");\n    i0.ɵɵelement(7, \"input\", 18)(8, \"mat-datepicker-toggle\", 9)(9, \"mat-datepicker\", null, 19);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const _r11 = i0.ɵɵreference(5);\n    const _r12 = i0.ɵɵreference(10);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"matDatepicker\", _r11);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"for\", _r11);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"matDatepicker\", _r12);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"for\", _r12);\n  }\n}\nexport let GenderChartsComponent = /*#__PURE__*/(() => {\n  class GenderChartsComponent {\n    constructor(personActivityService) {\n      this.personActivityService = personActivityService;\n      this.userData = [];\n      this.periodType = new FormControl(\"week\");\n      this.chart = {\n        chart: {\n          type: \"donut\",\n          id: '1'\n        },\n        series: [0, 0],\n        labels: [\"Hommes\", \"Femmes\"],\n        colors: [\"#008FFB\", \"#FF4560\"],\n        title: {\n          text: \"Répartition hommes/femmes\",\n          align: \"center\",\n          margin: 10,\n          offsetY: 20,\n          style: {\n            fontSize: \"25px\"\n          }\n        },\n        plotOptions: {\n          pie: {\n            donut: {\n              labels: {\n                show: true,\n                name: {\n                  show: true\n                },\n                value: {\n                  show: true,\n                  formatter: function (val) {\n                    return val + \" (\" + Math.round(val / this.chart.series[0].data.reduce((a, b) => a + b) * 100) + \"%)\";\n                  }\n                },\n                total: {\n                  show: true,\n                  formatter: function (val) {\n                    return Math.round(val / this.series[0].data.reduce((a, b) => a + b) * 100) + \"%\";\n                  }\n                }\n              }\n            }\n          }\n        }\n      };\n    }\n    ngOnInit() {\n      this.weekRangeFormGroup = new FormGroup({\n        start: new FormControl(),\n        end: new FormControl()\n      });\n      this.periodType.setValue(\"week\");\n      this.year = parseInt(moment().format(\"y\"));\n      this.month = parseInt(moment().format(\"M\"));\n      this.weekNumber = parseInt(moment().format(\"w\"));\n      this.startDate = new Date(this.year, this.month);\n      this.endDate = new Date();\n      // initialisation du graphique\n      this.getUserData(12, 2023);\n    }\n    submit() {\n      const startWeek = this.getWeekNumber(this.weekRangeFormGroup.controls.start.value);\n      const endWeek = this.getWeekNumber(this.weekRangeFormGroup.controls.end.value);\n      console.log(`Plage de semaines sélectionnée : ${startWeek} à ${endWeek}`);\n    }\n    getWeekNumber(date) {\n      const firstDayOfYear = new Date(date.getFullYear(), 0, 1);\n      const pastDaysOfYear = (date.getTime() - firstDayOfYear.getTime()) / 86400000;\n      return Math.ceil((pastDaysOfYear + firstDayOfYear.getDay() + 1) / 7);\n    }\n    getUserData(week, year) {\n      if (!week && !year) {\n        this.personActivityService.getData(week, year).subscribe({\n          next: data => {\n            this.userData = data;\n            this.updateChartData();\n          }\n        });\n      }\n      this.personActivityService.getData(week, year).subscribe({\n        next: data => {\n          this.userData = data;\n          this.updateChartData();\n        }\n      });\n    }\n    updateChartData() {\n      let filteredData = [];\n      if (this.periodType.value === \"week\") {\n        filteredData = this.userData.filter(person => {\n          let weekDate = new Date(person.PersonActivities[0].Year, 0, 1);\n          weekDate.setDate(1 - weekDate.getDay() + (weekDate.getDay() > 4 ? 7 : 0));\n          weekDate.setDate(weekDate.getDate() + 7 * (this.weekNumber - 1));\n          return weekDate.getFullYear() === this.year && person.PersonActivities.some(activity => activity.Value > 0);\n        });\n      } else if (this.periodType.value === \"month\") {\n        filteredData = this.userData.filter(person => {\n          return new Date(person.PersonActivities[0].Year, person.PersonActivities[0].Week * 7).getMonth() === this.month - 1 && person.PersonActivities.some(activity => activity.Value > 0);\n        });\n      } else if (this.periodType.value === \"year\") {\n        filteredData = this.userData.filter(person => {\n          return new Date(person.PersonActivities[0].Year, person.PersonActivities[0].Week * 7).getFullYear() === this.year && person.PersonActivities.some(activity => activity.Value > 0);\n        });\n      } else if (this.periodType.value === \"range\") {\n        filteredData = this.userData.filter(person => {\n          return person.PersonActivities.some(activity => activity.Value > 0 && new Date(activity.Year, 0).getTime() >= this.startDate.getTime() && new Date(activity.Year, 0).getTime() <= this.endDate.getTime());\n        });\n      }\n      let malesCount = filteredData.filter(person => person.GenderId === 1).length;\n      let femalesCount = filteredData.filter(person => person.GenderId === 2).length;\n      if (this.chart) {\n        this.chart.series = [{\n          name: \"Hommes\",\n          data: [malesCount]\n        }, {\n          name: \"Femmes\",\n          data: [femalesCount]\n        }];\n        ApexCharts.exec(this.chart.chart.id, \"updateOptions\", {\n          labels: [\"Hommes\", \"Femmes\"],\n          series: [{\n            name: \"Hommes\",\n            data: [malesCount]\n          }, {\n            name: \"Femmes\",\n            data: [femalesCount]\n          }]\n        });\n      }\n    }\n  }\n  GenderChartsComponent.ɵfac = function GenderChartsComponent_Factory(t) {\n    return new (t || GenderChartsComponent)(i0.ɵɵdirectiveInject(i1.PersonActivityService));\n  };\n  GenderChartsComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: GenderChartsComponent,\n    selectors: [[\"app-gender-charts\"]],\n    decls: 19,\n    vars: 7,\n    consts: [[3, \"formControl\"], [\"value\", \"week\"], [\"value\", \"month\"], [\"value\", \"year\"], [\"value\", \"range\"], [4, \"ngIf\"], [3, \"click\"], [3, \"series\", \"chart\"], [\"matInput\", \"\", \"placeholder\", \"S\\u00E9lectionner une semaine\", 3, \"matDatepicker\"], [\"matSuffix\", \"\", 3, \"for\"], [\"startView\", \"multi-year\", 3, \"selectedChanged\"], [\"weekPicker\", \"\"], [\"matInput\", \"\", \"placeholder\", \"Ann\\u00E9e\", 3, \"matDatepicker\"], [\"yearPicker\", \"\"], [\"matInput\", \"\", \"placeholder\", \"Mois\", 3, \"matDatepicker\"], [\"monthPicker\", \"\"], [\"matInput\", \"\", \"placeholder\", \"Start Date\", 3, \"matDatepicker\"], [\"startDatePicker\", \"\"], [\"matInput\", \"\", \"placeholder\", \"End Date\", 3, \"matDatepicker\"], [\"endDatePicker\", \"\"]],\n    template: function GenderChartsComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"mat-form-field\")(1, \"mat-label\");\n        i0.ɵɵtext(2, \"Periode\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(3, \"mat-select\", 0)(4, \"mat-option\", 1);\n        i0.ɵɵtext(5, \"Semaine\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(6, \"mat-option\", 2);\n        i0.ɵɵtext(7, \"Mois\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(8, \"mat-option\", 3);\n        i0.ɵɵtext(9, \"Ann\\u00E9e\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(10, \"mat-option\", 4);\n        i0.ɵɵtext(11, \"Plage de dates\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵtemplate(12, GenderChartsComponent_div_12_Template, 11, 4, \"div\", 5);\n        i0.ɵɵtemplate(13, GenderChartsComponent_div_13_Template, 11, 4, \"div\", 5);\n        i0.ɵɵtemplate(14, GenderChartsComponent_div_14_Template, 6, 2, \"div\", 5);\n        i0.ɵɵtemplate(15, GenderChartsComponent_div_15_Template, 11, 4, \"div\", 5);\n        i0.ɵɵelementStart(16, \"button\", 6);\n        i0.ɵɵlistener(\"click\", function GenderChartsComponent_Template_button_click_16_listener() {\n          return ctx.getUserData();\n        });\n        i0.ɵɵtext(17, \"Load data\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(18, \"apx-chart\", 7);\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"formControl\", ctx.periodType);\n        i0.ɵɵadvance(9);\n        i0.ɵɵproperty(\"ngIf\", ctx.periodType.value === \"week\");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.periodType.value === \"month\");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.periodType.value === \"year\");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.periodType.value === \"range\");\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"series\", ctx.userData)(\"chart\", ctx.chart);\n      }\n    },\n    dependencies: [i2.MatFormField, i2.MatLabel, i2.MatSuffix, i3.MatInput, i4.MatDatepicker, i4.MatDatepickerInput, i4.MatDatepickerToggle, i5.NgIf, i6.MatOption, i7.MatSelect, i8.NgControlStatus, i8.FormControlDirective, i9.ChartComponent]\n  });\n  return GenderChartsComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}